(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{XfGX:function(e,t,i){"use strict";i.r(t),i.d(t,"DataUploadModule",function(){return F});var n=i("ofXK"),a=i("tE69"),r=i("3Pt+"),o=i("tyNb"),s=i("tyVc"),c=i("ZOsW"),l=i("njyG"),d=i("AytR"),u=i("IheW"),b=i("PSD3"),p=i.n(b),f=i("fXoL"),h=i("EAui"),g=i("nkOh"),m=i("Txdn"),v=i("ltvU"),y=i("xNm2"),w=i("IYwT");function I(e,t){1&e&&(f.Rb(0,"div",2),f.Rb(1,"div",3),f.Ic(2,"Loading..."),f.Qb(),f.Qb())}function O(e,t){if(1&e&&(f.Rb(0,"div",30),f.Rb(1,"div",31),f.Ic(2),f.Qb(),f.Qb()),2&e){const e=f.dc(2);f.yb(1),f.Ec("width: ",e.progress,"%;"),f.yb(1),f.Kc(" ",e.progress,"%")}}function R(e,t){if(1&e&&(f.Rb(0,"th"),f.Ic(1),f.Qb()),2&e){const e=f.dc().$implicit;f.yb(1),f.Jc(e.colname)}}function T(e,t){if(1&e&&(f.Pb(0),f.Gc(1,R,2,1,"th",34),f.Ob()),2&e){const e=t.$implicit;f.yb(1),f.jc("ngIf",e.is_view)}}function _(e,t){if(1&e&&(f.Pb(0),f.Rb(1,"td",35),f.Ic(2),f.Qb(),f.Ob()),2&e){const e=f.dc().$implicit,t=f.dc().$implicit;f.yb(1),f.jc("ngClass",1===t.with_error?"has_error":""),f.yb(1),f.Jc(t[e])}}function Q(e,t){if(1&e&&(f.Pb(0),f.Gc(1,_,3,2,"ng-container",34),f.Ob()),2&e){const e=t.$implicit;f.yb(1),f.jc("ngIf","with_error"!==e)}}function x(e,t){if(1&e&&(f.Rb(0,"tr"),f.Gc(1,Q,2,1,"ng-container",33),f.Qb()),2&e){const e=t.$implicit,i=f.dc(3);f.yb(1),f.jc("ngForOf",i._object.keys(e))}}function L(e,t){if(1&e&&(f.Rb(0,"table",32),f.Rb(1,"thead"),f.Rb(2,"tr"),f.Gc(3,T,2,1,"ng-container",33),f.Qb(),f.Qb(),f.Rb(4,"tbody"),f.Gc(5,x,2,1,"tr",33),f.Qb(),f.Qb()),2&e){const e=f.dc(2);f.yb(3),f.jc("ngForOf",e.tableOutput),f.yb(2),f.jc("ngForOf",e.returnOutput)}}function S(e,t){if(1&e){const e=f.Sb();f.Rb(0,"div",4),f.Rb(1,"div",5),f.Rb(2,"div",6),f.Rb(3,"h6"),f.Ic(4,"Data Upload"),f.Qb(),f.Qb(),f.Rb(5,"div",7),f.Rb(6,"div",8),f.Rb(7,"div",9),f.Rb(8,"div",10),f.Rb(9,"label",11),f.Ic(10,"Data Upload"),f.Qb(),f.Rb(11,"ng-select",12),f.bc("ngModelChange",function(t){return f.xc(e),f.dc().selectedData=t})("change",function(){return f.xc(e),f.dc().onChange()}),f.Qb(),f.Qb(),f.Qb(),f.Rb(12,"div",13),f.Rb(13,"div",10),f.Rb(14,"label",11),f.Ic(15,"\xa0"),f.Qb(),f.Rb(16,"input",14,15),f.bc("change",function(t){return f.xc(e),f.dc().uploadFile(t)}),f.Qb(),f.Rb(18,"div",16),f.bc("click",function(t){return f.xc(e),f.dc().openFileBrowser(t)}),f.Mb(19,"input",17),f.Rb(20,"span",18),f.Rb(21,"button",19),f.Mb(22,"i",20),f.Ic(23," Upload"),f.Qb(),f.Ic(24," \xa0 "),f.Qb(),f.Qb(),f.Gc(25,O,3,4,"div",21),f.Qb(),f.Qb(),f.Rb(26,"div",22),f.Rb(27,"div",10),f.Rb(28,"label",11),f.Ic(29,"\xa0"),f.Qb(),f.Rb(30,"div",10),f.Rb(31,"button",23),f.bc("click",function(){return f.xc(e),f.dc().exportTemplate()}),f.Mb(32,"i",24),f.Ic(33," Download Template"),f.Qb(),f.Ic(34,"\xa0 "),f.Rb(35,"button",25),f.bc("click",function(){return f.xc(e),f.dc().submit()}),f.Mb(36,"i",26),f.Ic(37," Save "),f.Qb(),f.Qb(),f.Qb(),f.Qb(),f.Qb(),f.Mb(38,"hr"),f.Rb(39,"div",27),f.Rb(40,"p",28),f.Ic(41),f.Qb(),f.Gc(42,L,6,2,"table",29),f.Qb(),f.Qb(),f.Qb(),f.Qb()}if(2&e){const e=f.dc();f.yb(11),f.jc("items",e.uploadList)("ngModel",e.selectedData),f.yb(14),f.jc("ngIf",e.progress>0),f.yb(16),f.Jc(e.errorText),f.yb(1),f.jc("ngIf",e.showTable)}}const M=[{path:"",component:a.a,children:[{path:"",redirectTo:"data-upload",pathMatch:"full"},{path:"data-upload",component:(()=>{class e{constructor(e,t,i,n,a,r,o){this.permissionManagementService=e,this.dataUploadManagementService=t,this.http=i,this.handler=n,this.tenantDefaultService=a,this.userManagementService=r,this.filingManagementService=o,this.uri=d.a.exportUrl,this.isLoading=!0,this.showTable=!0,this.uploadList=[],this.headerList=[],this.tableOutput=[],this.selectedOutput=[],this.returnOutput=[],this.progress=0,this._object=Object,this.uploadFile=e=>{e.target.files.length&&document.querySelector("#fileUploadInputExample + .input-group .file-upload-info").setAttribute("value",e.target.files[0].name);var t=e.target.files;0!==t.length&&this.uploadFiles(t)}}ngOnInit(){this.http=new u.c(this.handler),this.permissionManagementService.dataUploadAccess(sessionStorage.getItem("al")).subscribe(e=>{this.uploadList=e,this.isLoading=!1},e=>{console.log(e.error)})}openFileBrowser(e){e.preventDefault(),document.querySelector("#fileUploadInputExample").click(),e.target.files&&e.target.files[0]&&(new FileReader).readAsDataURL(e.target.files[0])}onChange(){this.tableOutput=[],this.headerList=[],this.returnOutput=[],this.dataUploadManagementService.uploadHeader(this.selectedData).subscribe(e=>{this.tableOutput=e,this.headerList=e,this.showTable=!0},e=>{console.log(e.error)})}exportTemplate(){const e=this.uploadList.filter(e=>e.data_upload_id===this.selectedData)[0];this.dataUploadManagementService.downloadTemplate(e.export).subscribe(e=>{window.location.href=this.uri+e.response},e=>{console.log(e.error)})}uploadFiles(e){this.errorText="";const t=this.uploadList.filter(e=>e.data_upload_id===this.selectedData)[0];this.http=new u.c(this.handler);let i=e[0];const n=new FormData;n.append("formfile",i,i.name),this.http.post(this.uri+t.upload+"?created_by="+sessionStorage.getItem("u")+"&dropdown_id="+this.selectedData+"&series_code="+sessionStorage.getItem("sc"),n,{reportProgress:!0,observe:"events"}).subscribe(e=>{e.type===u.e.UploadProgress?this.progress=Math.round(100*e.loaded/e.total):e.type===u.e.Response&&(p.a.fire("Ok!","Upload successful!","success"),this.dataUploadManagementService.uploadDetail(this.selectedData).subscribe(e=>{let t=JSON.parse(e.toString());this.selectedOutput=JSON.parse(e.toString());for(var i=0;i<this.tableOutput.length;i++){let e=this.tableOutput[i].columns,n=this.tableOutput[i].is_view;"with_error"!==e&&(n||t.forEach(function(t){delete t[e]}))}this.returnOutput=t,this.returnOutput.filter(e=>1===e.with_error).length>0&&(this.errorText="There are "+this.returnOutput.filter(e=>1===e.with_error).length+" rows error on your file please review.")},e=>{console.log(e.error)}))})}submit(){let e="Are you sure?";this.returnOutput.filter(e=>1===e.with_error).length>0&&(e="Are you sure sure you want to continue? There are "+this.returnOutput.filter(e=>1===e.with_error).length+" rows that will not be saved."),p.a.fire({title:e,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes",showLoaderOnConfirm:!0}).then(e=>{e.isConfirmed&&p.a.fire({title:"Please Wait !",allowOutsideClick:!1,onBeforeOpen:()=>{p.a.showLoading();const e=this.uploadList.filter(e=>e.data_upload_id===this.selectedData)[0];var t={series_code:sessionStorage.getItem("sc"),created_by:sessionStorage.getItem("u")};switch(e.service){case"TenantSetupManagement":this.tenantDefaultService.uploadIn(e.save,t).subscribe(e=>{0===e?p.a.fire("Failed!","Transaction failed!","error"):p.a.fire("Ok!","Transaction successful!","success")},e=>{console.log(e.error),p.a.fire("Failed!","Transaction failed!","error")});break;case"UserManagement":this.userManagementService.uploadIn(e.save,t).subscribe(e=>{0===e?p.a.fire("Failed!","Transaction failed!","error"):p.a.fire("Ok!","Transaction successful!","success")},e=>{console.log(e.error),p.a.fire("Failed!","Transaction failed!","error")});break;case"FilingManagement":this.filingManagementService.uploadIn(e.save,t).subscribe(e=>{0===e?p.a.fire("Failed!","Transaction failed!","error"):p.a.fire("Ok!","Transaction successful!","success")},e=>{console.log(e.error),p.a.fire("Failed!","Transaction failed!","error")})}}})})}}return e.\u0275fac=function(t){return new(t||e)(f.Lb(h.a),f.Lb(g.a),f.Lb(u.c),f.Lb(u.b),f.Lb(m.a),f.Lb(v.a),f.Lb(y.a))},e.\u0275cmp=f.Fb({type:e,selectors:[["app-uploader"]],decls:2,vars:2,consts:[["class","spinner-wrapper",4,"ngIf"],["class","animate__animated animate__fadeInUp",4,"ngIf"],[1,"spinner-wrapper"],[1,"spinner"],[1,"animate__animated","animate__fadeInUp"],[1,"card"],[1,"card-header"],[1,"card-body"],[1,"row"],[1,"col-md-3"],[1,"form-group"],[1,"control-label"],["name","industry","bindLabel","data_upload_name","bindValue","data_upload_id","placeholder","Select Data Upload",3,"items","ngModel","ngModelChange","change"],[1,"col-md-5"],["placeholder","Choose file","type","file","name","img[]","id","fileUploadInputExample",1,"file-upload-default",3,"change"],["file",""],[1,"input-group","col-xs-12",3,"click"],["type","text","disabled","","placeholder","Upload Log",1,"form-control","file-upload-info"],[1,"input-group-append"],["type","button",1,"file-upload-browse","btn","btn-primary","btn-icon-text"],["data-feather","upload","appFeatherIcon","",1,"btn-icon-prepend"],["class","progress",4,"ngIf"],[1,"col-md-4"],["type","button",1,"btn","btn-primary","btn-icon-text",3,"click"],["data-feather","download","appFeatherIcon","",1,"btn-icon-prepend"],[1,"btn","btn-primary","btn-icon-text",3,"click"],["data-feather","save","appFeatherIcon","",1,"btn-icon-prepend"],[1,"table-responsive"],[1,"text-danger","mt-1"],["id","dataTableExample","class","table table-bordered",4,"ngIf"],[1,"progress"],["role","progressbar","aria-valuemin","0","aria-valuemax","100",1,"progress-bar"],["id","dataTableExample",1,"table","table-bordered"],[4,"ngFor","ngForOf"],[4,"ngIf"],[3,"ngClass"]],template:function(e,t){1&e&&(f.Gc(0,I,3,0,"div",0),f.Gc(1,S,43,5,"div",1)),2&e&&(f.jc("ngIf",t.isLoading),f.yb(1),f.jc("ngIf",!t.isLoading))},directives:[n.n,c.a,r.i,r.l,w.a,n.m,n.l],styles:[".has_error[_ngcontent-%COMP%]{background-color:#9acd32}"]}),e})()}]}];let F=(()=>{class e{}return e.\u0275mod=f.Jb({type:e}),e.\u0275inj=f.Ib({factory:function(t){return new(t||e)},imports:[[n.c,r.f,r.p,o.g.forChild(M),s.a,c.b,l.b]]}),e})()},njyG:function(e,t,i){"use strict";i.d(t,"a",function(){return a}),i.d(t,"b",function(){return o});var n=i("fXoL"),a=function(){function e(e){this.el=e,this.dtOptions={}}return e.prototype.ngOnInit=function(){var e=this;this.dtTrigger?this.dtTrigger.subscribe(function(){e.displayTable()}):this.displayTable()},e.prototype.ngOnDestroy=function(){this.dtTrigger&&this.dtTrigger.unsubscribe(),this.dt&&this.dt.destroy(!0)},e.prototype.displayTable=function(){var e=this;this.dtInstance=new Promise(function(t,i){Promise.resolve(e.dtOptions).then(function(i){setTimeout(function(){var n={rowCallback:function(t,n,a){if(i.columns){var r=i.columns;r.filter(function(e){return e.ngPipeInstance}).forEach(function(e){var i=e.ngPipeInstance,n=r.findIndex(function(t){return t.data==e.data}),a=t.childNodes.item(n),o=$(a).text(),s=i.transform(o);$(a).text(s)})}e.dtOptions.rowCallback&&e.dtOptions.rowCallback(t,n,a)}};n=Object.assign({},i,n),e.dt=$(e.el.nativeElement).DataTable(n),t(e.dt)})})})},e.\u0275fac=function(t){return new(t||e)(n.Lb(n.l))},e.\u0275dir=n.Gb({type:e,selectors:[["","datatable",""]],inputs:{dtOptions:"dtOptions",dtTrigger:"dtTrigger"}}),e}(),r=i("ofXK"),o=function(){function e(){}return e.forRoot=function(){return{ngModule:e}},e.\u0275mod=n.Jb({type:e}),e.\u0275inj=n.Ib({factory:function(t){return new(t||e)},imports:[[r.c]]}),e}()}}]);